"""Water masks derived from Pekel et al. paper."""

import numpy as np

from .utils import PekelBands


def combine_masks(b: PekelBands, cloud_mask=True) -> np.ndarray:
    """Return the overall mask."""
    mask = (
        (water1(b) + water2(b) ^ water3(b))
        * (confusion1a(b) + confusion1b(b))
        * (confusion2a(b) + confusion2b(b) + confusion2c(b) + confusion2d(b))
        * (confusion3a(b) + confusion3b(b) + confusion4a(b) + confusion4b(b))
        * (confusion6(b) + clouds(b))
    ).astype(np.int8)

    mask[invalid(b)] = -1
    if cloud_mask:
        mask[iscloud(b)] = -2

    return mask


def invalid(b):
    """Invalid cells."""
    # Invalid in all bands are set to -1 in fill_nodata_single()
    # Choosing blue here is arbitrary
    return b.blue == -1


def iscloud(b):
    """Cells covered in cloud."""
    return b.cloud == 1


def water1(b):
    """Water cluster where NDVI <0"""
    return (b.val < 0.62) & (
        (
            (b.hue < ((-9.867784585617413 * b.ndvi) + 238.26034242940045))
            & (b.hue > ((-12960.000000000335 * b.ndvi) - 12714.048607819708))
            & (b.hue > ((23.627546071775214 * b.ndvi) + 255.53176874753507))
        )
        | (
            (b.hue < ((-54.685799109352004 * b.ndvi) + 215.15052322834936))
            & (b.hue < ((23.627546071775214 * b.ndvi) + 255.53176874753507))
            & (b.hue > ((-7.321079389910027 * b.ndvi) + 224.6166270396205))
        )
        | (
            (b.hue < ((-172.0408163265306 * b.ndvi) + 191.69646750224035))
            & (b.hue < ((-7.321079389910027 * b.ndvi) + 224.6166270396205))
            & (b.hue > ((-38.11764705882351 * b.ndvi) + 193.8533786110101))
        )
        | (
            (b.hue > ((-52.06378986866776 * b.ndvi) + 179.92232432949075))
            & (b.hue < ((-879.6226415094455 * b.ndvi) + 180.3004476242325))
            & (b.hue < ((-38.11764705882351 * b.ndvi) + 193.8533786110101))
        )
    )


def water2(b):
    """Water cluster where NDVI>0"""
    return (b.val < 0.62) & (
        (
            (b.hue < ((-119.15098406819945 * b.ndvi) + 180.0533162435398))
            & (b.hue > ((-994.2857142867327 * b.ndvi) + 180.04805813312743))
            & (b.hue > ((-116.5000234173271 * b.ndvi) + 179.9633248496054))
        )
        | (
            (b.hue < ((-2368.4258422651174 * b.ndvi) + 256.40879883589054))
            & (b.hue < ((-116.5000234173271 * b.ndvi) + 179.9633248496054))
            & (b.hue > ((-267.6720052547653 * b.ndvi) + 179.97791758964533))
        )
        | (
            (b.hue < ((-108.07947019867622 * b.ndvi) + 179.67747476669464))
            & (b.hue > ((-2368.4258422651174 * b.ndvi) + 256.40879883589054))
            & (b.hue > ((58.99660016815455 * b.ndvi) + 168.09286521078695))
        )
        | (
            (b.hue < ((-104.45621862799788 * b.ndvi) + 179.4262481567021))
            & (b.hue < ((58.99660016815455 * b.ndvi) + 168.09286521078695))
            & (b.hue > ((-52.1565190088889 * b.ndvi) + 172.13690440390852))
        )
        | (
            (b.hue < ((-52.1565190088889 * b.ndvi) + 172.13690440390852))
            & (b.hue > ((-204.2258047185466 * b.ndvi) + 177.66958001421082))
            & (b.hue > ((37.74894387447151 * b.ndvi) + 159.60620482085795))
        )
    )


def water3(b):
    """Sensor calibration issue (SWIR1 or SWIR2 <0)"""
    return (b.swir1 < 0) | (b.swir2 < 0)


def confusion1a(b):
    """Class spectral overlap (clouds, snow and hard pan)"""
    return (
        (
            (b.hue < ((-49.74358974358937 * b.ndvi) + 196.13881379789424))
            & (b.hue > ((-388.2352941176396 * b.ndvi) + 71.02910650151634))
            & (b.hue > ((-23.22580645161292 * b.ndvi) + 203.03136575198846))
        )
        | (
            (b.hue < ((-77.40259740259752 * b.ndvi) + 188.94963266652547))
            & (b.hue < ((-23.22580645161292 * b.ndvi) + 203.03136575198846))
            & (b.hue > ((-51.16071428571436 * b.ndvi) + 192.92896822354658))
        )
        | (
            (b.hue > ((-66.84871654833425 * b.ndvi) + 187.2555492802913))
            & (b.hue < ((-110.14373716632423 * b.ndvi) + 183.9847457695416))
            & (b.hue < ((-51.16071428571436 * b.ndvi) + 192.92896822354658))
        )
        | (
            (b.hue < ((-66.84871654833425 * b.ndvi) + 187.2555492802913))
            & (b.hue > ((-90.93264248704664 * b.ndvi) + 178.5458232513616))
            & (b.hue < ((-181.85567010309282 * b.ndvi) + 178.56713333595917))
        )
        | (
            (b.hue > ((-181.85567010309282 * b.ndvi) + 178.56713333595917))
            & (b.hue < ((-5040.000000000369 * b.ndvi) + 179.70576091328076))
            & (b.hue < ((-151.6182572614111 * b.ndvi) + 180.85147538423308))
        )
    )


def confusion1b(b):
    """Class spectral overlap (clouds, snow and hard pan)"""
    return (
        (
            (b.sat < ((-7.661776708707255 * b.blue) + 2.2305740929954756))
            & (b.sat < ((0 * b.blue) + 1.1986832555860636))
            & (b.sat > ((-1.261626977704373 * b.blue) + 1.2006455384115522))
        )
        | (
            (b.sat < ((-1.261626977704373 * b.blue) + 1.2006455384115524))
            & (b.sat > ((-185.04244838331917 * b.blue) + 1.4864906858850455))
            & (b.sat > ((3.157630522088353 * b.blue) + 0.48948725612204136))
        )
        | (
            (b.sat > ((1.9125690254685646 * b.blue) + 0.4960830587891577))
            & (b.sat < ((-0.19140526983264608 * b.blue) + 1.0284227087903544))
            & (b.sat < ((3.157630522088353 * b.blue) + 0.48948725612204136))
        )
        | (
            (b.sat < ((-1.2188600719125362 * b.blue) + 1.2883854521341145))
            & (b.sat < ((-0.04742916852574311 * b.blue) + 1.005253704291078))
            & (b.sat > ((-0.19140526983264608 * b.blue) + 1.0284227087903544))
        )
        | (
            (b.sat < ((1.9125690254685646 * b.blue) + 0.49608305878915765))
            & (b.sat > ((-0.34084769909052515 * b.blue) + 0.5080206956708082))
            & (b.sat > ((12.772331898427453 * b.blue) - 2.2516132318916604))
        )
    )


def confusion2a(b):
    """Class spectral overlap (shadow, bare rock and lava flow)"""
    return (
        (
            (b.hue < ((-323.2653061224475 * b.ndvi) + 183.40185793495874))
            & (b.hue < ((158.07495741056292 * b.ndvi) + 215.95099454586804))
            & (b.hue > ((-19.45161290322491 * b.ndvi) + 195.80505541813127))
        )
        | (
            (b.hue < ((-19.45161290322491 * b.ndvi) + 195.80505541813127))
            & (b.hue > ((-114.87179487179472 * b.ndvi) + 184.97665280719505))
            & (b.hue > ((38.393782383421026 * b.ndvi) + 198.16659433900784))
        )
        | (
            (b.hue < ((-360.00000000000256 * b.ndvi) + 181.9021636393549))
            & (b.hue < ((38.393782383421026 * b.ndvi) + 198.16659433900784))
            & (b.hue > ((-43.145604395603854 * b.ndvi) + 191.14936474697558))
        )
        | (
            (b.hue < ((-43.145604395603854 * b.ndvi) + 191.14936474697558))
            & (b.hue > ((-158.76923076923046 * b.ndvi) + 181.19886641019133))
            & (b.hue > ((429.86013986014024 * b.ndvi) + 204.95374714744474))
        )
        | (
            (b.hue < ((-398.29787234042374 * b.ndvi) + 180.784463735428))
            & (b.hue < ((429.86013986014024 * b.ndvi) + 204.95374714744474))
            & (b.hue > ((18.69718309859311 * b.ndvi) + 188.36074739446966))
        )
        | (
            (b.hue < ((-2132.068965517284 * b.ndvi) + 149.28399045541414))
            & (b.hue < ((18.69718309859311 * b.ndvi) + 188.36074739446966))
            & (b.hue > ((-180.57507987220498 * b.ndvi) + 180.31886386417185))
        )
        | (
            (b.hue < ((-401.15384615384954 * b.ndvi) + 180.73257422870344))
            & (b.hue > ((-2132.068965517284 * b.ndvi) + 149.28399045541414))
            & (b.hue > ((-156.29268292682937 * b.ndvi) + 180.705030134435))
        )
        | (
            (b.hue < ((-4859.999999999733 * b.ndvi) + 181.23414367798406))
            & (b.hue < ((-156.29268292682937 * b.ndvi) + 180.705030134435))
            & (b.hue > ((-201.73913043478356 * b.ndvi) + 179.98228908171535))
        )
    )


def confusion2b(b):
    """Class spectral overlap (shadow, bare rock and lava flow)"""
    return (
        (
            (b.swir2 < ((-0.323042168674698 * b.blue) + 0.06801551910768028))
            & (b.swir2 < ((0.5604681404421293 * b.blue) - 0.026340620936280618))
            & (b.swir2 > ((0.0009537434430138915 * b.blue) - 0.00020080770147852338))
        )
        | (
            (b.swir2 < ((-0.49875724937862376 * b.blue) + 0.10501178024026461))
            & (b.swir2 < ((1.4297520661157026 * b.blue) - 0.11917742768595024))
            & (b.swir2 > ((-0.323042168674698 * b.blue) + 0.06801551910768028))
        )
        | (
            (b.swir2 < ((-0.7169373549883978 * b.blue) + 0.1509489196635725))
            & (b.swir2 < ((1.3166023166023175 * b.blue) - 0.10602376930501928))
            & (b.swir2 > ((-0.49875724937862376 * b.blue) + 0.10501178024026461))
        )
        | (
            (b.swir2 > ((8.135802469135795 * b.blue) - 1.7129677854938241))
            & (b.swir2 < ((-0.09797151488994237 * b.blue) + 0.07273194729175612))
            & (b.swir2 > ((-0.7169373549883978 * b.blue) + 0.1509489196635725))
        )
        | (
            (b.swir2 < ((-0.3973412112259951 * b.blue) + 0.1376577501846375))
            & (b.swir2 < ((2.0279720279720297 * b.blue) - 0.19591755900349633))
            & (b.swir2 > ((-0.09797151488994237 * b.blue) + 0.07273194729175612))
        )
        | (
            (b.swir2 < ((-0.9340727048675277 * b.blue) + 0.2540613928681448))
            & (b.swir2 < ((1.7377450980392386 * b.blue) - 0.15600001914828718))
            & (b.swir2 > ((-0.3973412112259951 * b.blue) + 0.1376577501846375))
        )
        | (
            (b.swir2 < ((0.5585585585585591 * b.blue) + 0.024977477477477597))
            & (b.swir2 > ((-0.9340727048675277 * b.blue) + 0.2540613928681448))
            & (b.swir2 > ((16.392156862745423 * b.blue) - 3.503564644607911))
        )
        | (
            (b.swir2 > ((2.1705685618729085 * b.blue) - 0.4192576818561867))
            & (b.swir2 < ((0.08437200383509218 * b.blue) + 0.1306506921140938))
            & (b.swir2 < ((16.392156862745423 * b.blue) - 3.503564644607911))
        )
        | (
            (b.swir2 > ((0.5275310834813499 * b.blue) - 0.06292392873001777))
            & (b.swir2 < ((-1.3333333333333348 * b.blue) + 0.5043489583333338))
            & (b.swir2 < ((2.1705685618729085 * b.blue) - 0.4192576818561867))
        )
    )


def confusion2c(b):
    """Class spectral overlap (shadow, bare rock and lava flow)"""
    return (
        (b.val2 < ((-3.0133928571428577 * b.swir2) + 0.7676348612804655))
        & (b.val2 < ((-0.2571428571428576 * b.swir2) + 0.4733992419470712))
        & (b.val2 > ((-1.3327526132404202 * b.swir2) + 0.47057808119912775))
    ) | (
        (b.val2 > ((1.0686619718309858 * b.swir2) + 0.04612288510953274))
        & (b.val2 < ((-1.3327526132404202 * b.swir2) + 0.4705780811991277))
        & (b.val2 > ((-228.66666666671583 * b.swir2) - 0.12568418898601724))
    )


def confusion2d(b):
    """Class spectral overlap (shadow, bare rock and lava flow)"""
    return b.hue2 > 238


def confusion3a(b):
    """Class spectral overlap (clouds, snow, hard pan and bare rock) when NDVI >0"""
    return (
        (
            (b.sat < ((-2.2326203208556143 * b.val) + 1.5257678652540891))
            & (b.sat < ((-0.00534759358288754 * b.val) + 0.9973687549803982))
            & (b.sat > ((-0.7477718360071299 * b.val) + 0.9999601250716116))
        )
        | (
            (b.sat > ((0.7335092348284965 * b.val) + 0.4754156611894009))
            & (b.sat < ((-0.7397078353253644 * b.val) + 1.1715886848550134))
            & (b.sat > ((-2.2326203208556143 * b.val) + 1.5257678652540891))
        )
        | (
            (b.sat < ((-16.484848484848392 * b.val) + 8.612000825120266))
            & (b.sat < ((-0.018055555555555623 * b.val) + 1.0003835971762043))
            & (b.sat > ((-0.7397078353253644 * b.val) + 1.1715886848550134))
        )
        | (
            (b.sat > ((1.545243619489559 * b.val) + 0.18796800118751184))
            & (b.sat < ((-0.7477718360071299 * b.val) + 0.9999601250716116))
            & (b.sat > ((-2.178002894356006 * b.val) + 1.004952227667868))
        )
        | (
            (b.sat > ((0.4907407407407418 * b.val) + 0.41935537119167954))
            & (b.sat < ((-2.178002894356006 * b.val) + 1.0049522276678682))
            & (b.sat > ((-42.39534883720828 * b.val) + 1.1453275299128312))
        )
        | (
            (b.sat > ((1.8633540372670816 * b.val) + 0.11816569488389755))
            & (b.sat < ((0.4907407407407418 * b.val) + 0.41935537119167954))
            & (b.sat > ((0.03696098562628343 * b.val) + 0.4270369171578985))
        )
    )


def confusion3b(b):
    """Class spectral overlap (clouds, snow, hard pan and bare rock) when NDVI >0"""
    return (
        (
            (b.val2 < ((-8.999999999999996 * b.swir2) + 1.1836428258302192))
            & (b.val2 < ((-0.25605798072220454 * b.swir2) + 0.4734020874128705))
            & (b.val2 > ((-1.567464014026764 * b.swir2) + 0.46996246890364646))
        )
        | (
            (b.val2 < ((-1.567464014026764 * b.swir2) + 0.46996246890364646))
            & (b.val2 > ((-2.378156296376779 * b.swir2) + 0.46783614638503673))
            & (b.val2 > ((42.666666666666465 * b.swir2) - 3.77744786750256))
        )
        | (
            (b.val2 > ((2.0883643769837543 * b.swir2) + 0.046885467371981064))
            & (b.val2 < ((-2.378156296376779 * b.swir2) + 0.4678361463850367))
            & (b.val2 > ((-228.66666666671583 * b.swir2) - 0.12568418898601724))
        )
        | (
            (b.val2 < ((-4.78571428571428 * b.swir2) + 0.6947383023337331))
            & (b.val2 < ((2.0883643769837543 * b.swir2) + 0.04688546737198104))
            & (b.val2 > ((1.0673991822800284 * b.swir2) + 0.04612194073506829))
        )
    )


def confusion4a(b):
    """Class spectral overlap - specific soils"""
    return (
        (
            (b.hue < ((-171.9402985074626 * b.val) + 284.156529850746))
            & (b.hue < ((26.190476190476137 * b.val) + 177.22782738095222))
            & (b.hue > ((-15.423197492163006 * b.val) + 180.02374608150456))
        )
        | (
            (b.hue < ((-15.423197492163006 * b.val) + 180.02374608150456))
            & (b.hue > ((-787.6056338028174 * b.val) + 231.90475352112665))
            & (b.hue > ((205.6451612903227 * b.val) + 32.944203629032074))
        )
        | (
            (b.hue < ((205.6451612903227 * b.val) + 32.944203629032074))
            & (b.hue > ((-13.36870026525184 * b.val) + 76.81541777188309))
            & (b.hue > ((430.62670299727523 * b.val) - 116.73882833787471))
        )
    )


def confusion4b(b):
    """Class spectral overlap - specific soils"""
    return (
        (b.ndvi < ((-0.4006259780907667 * b.val) + 0.25238142590835944))
        & (b.ndvi < ((2.6183213726200956 * b.val) - 0.14069421605734192))
        & (b.ndvi > ((0.04660702286934955 * b.val) - 0.016930462975588336))
    ) | (
        (b.ndvi < ((-5.639344262295089 * b.val) + 3.4069990713440506))
        & (b.ndvi < ((0.04660702286934955 * b.val) - 0.01693046297558834))
        & (b.ndvi > ((-0.1755502266736536 * b.val) - 0.0062391453413314))
    )


def confusion5a(b):
    """Class spectral overlap (manly snow and ice)"""
    return (
        (
            (b.hue < ((-41.390273937152394 * b.ndvi) + 199.35367359600045))
            & (b.hue < ((980.036035727654 * b.ndvi) + 640.801356804259))
            & (b.hue > ((321.2575972304732 * b.ndvi) + 340.18915447676704))
        )
        | (
            (b.hue < ((-65.8789625360229 * b.ndvi) + 189.84341168861118))
            & (b.hue < ((321.2575972304732 * b.ndvi) + 340.18915447676704))
            & (b.hue > ((79.91668325971264 * b.ndvi) + 230.0610455089285))
        )
        | (
            (b.hue < ((-79.35871743486943 * b.ndvi) + 186.12503008982895))
            & (b.hue < ((79.91668325971264 * b.ndvi) + 230.0610455089285))
            & (b.hue > ((15.881427495031524 * b.ndvi) + 200.84063066666678))
        )
        | (
            (b.hue < ((-100.08620689655164 * b.ndvi) + 182.9224157290126))
            & (b.hue < ((15.881427495031524 * b.ndvi) + 200.84063066666678))
            & (b.hue > ((-7.254757545361759 * b.ndvi) + 190.28318201319394))
        )
        | (
            (b.hue < ((-124.615384615385 * b.ndvi) + 180.97745477457968))
            & (b.hue < ((-7.254757545361759 * b.ndvi) + 190.28318201319394))
            & (b.hue > ((-19.055497384172963 * b.ndvi) + 184.89829661814167))
        )
        | (
            (b.hue > ((-25.873050054257675 * b.ndvi) + 181.7873272802364))
            & (b.hue < ((-140.7166123778528 * b.ndvi) + 180.37940215061724))
            & (b.hue < ((-19.055497384172963 * b.ndvi) + 184.89829661814167))
        )
        | (
            (b.hue > ((-30.31391870513669 * b.ndvi) + 179.76088071280893))
            & (b.hue < ((-187.17066924733743 * b.ndvi) + 179.80989844735336))
            & (b.hue < ((-25.873050054257675 * b.ndvi) + 181.7873272802364))
        )
        | (
            (b.hue < ((-155.73667711598745 * b.ndvi) + 180.19526360453366))
            & (b.hue > ((-187.17066924733743 * b.ndvi) + 179.80989844735336))
            & (b.hue > ((953.6618512259481 * b.ndvi) + 179.45338828470543))
        )
        | (
            (b.hue > ((47.569422700668035 * b.ndvi) + 179.7365421686196))
            & (b.hue < ((31.592769201982623 * b.ndvi) + 180.0699929381771))
            & (b.hue < ((953.6618512259481 * b.ndvi) + 179.45338828470543))
        )
        | (
            (b.hue > ((31.592769201982623 * b.ndvi) + 180.0699929381771))
            & (b.hue < ((-102.42677824267734 * b.ndvi) + 182.86713197826745))
            & (b.hue < ((3158.312807223996 * b.ndvi) + 177.97909740428108))
        )
        | (
            (b.hue > ((-113.32329793300876 * b.ndvi) + 179.78682114381763))
            & (b.hue < ((-318.39195979899586 * b.ndvi) + 187.37456878244578))
            & (b.hue < ((47.569422700668035 * b.ndvi) + 179.7365421686196))
        )
        | (
            (b.hue < ((-113.32329793300876 * b.ndvi) + 179.78682114381763))
            & (b.hue > ((-142.88372093023278 * b.ndvi) + 179.79605877600426))
            & (b.hue < ((-159.8049491628185 * b.ndvi) + 181.50668919264223))
        )
        | (
            (b.hue > ((1080.0000000000098 * b.ndvi) + 56.170157613212425))
            & (b.hue < ((-120.30147453115049 * b.ndvi) + 180.0450207269362))
            & (b.hue > ((-159.8049491628185 * b.ndvi) + 181.50668919264223))
        )
        | (
            (b.hue < ((-30.31391870513669 * b.ndvi) + 179.76088071280893))
            & (b.hue > ((-55.18624641833813 * b.ndvi) + 168.4111995849124))
            & (b.hue > ((2769.534803268574 * b.ndvi) + 178.88592798719202))
        )
    )


def confusion5b(b):
    """Class spectral overlap (manly snow and ice)"""
    if b.tirs1 is None:
        return b.hue > -100  # always true
    else:
        return (
            (
                (b.tirs1 < ((-37.4607329842932 * b.swir1) + 270.5710658903785))
                & (b.tirs1 < ((3873.750000000057 * b.swir1) + 289.8215562167857))
                & (b.tirs1 > ((42.76923076923073 * b.swir1) + 213.50123620476631))
            )
            | (
                (b.tirs1 < ((-1.6063348416289716 * b.swir1) + 270.74753675623697))
                & (b.tirs1 > ((-37.4607329842932 * b.swir1) + 270.5710658903785))
                & (b.tirs1 > ((226.66666666666728 * b.swir1) + 82.6898179355349))
            )
            | (
                (b.tirs1 < ((-1.7241379310344813 * b.swir1) + 270.8445862545011))
                & (b.tirs1 < ((5.714285714284849 * b.swir1) + 270.7835679355356))
                & (b.tirs1 > ((-1.6063348416289716 * b.swir1) + 270.74753675623697))
            )
            | (
                (b.tirs1 < ((-15.871404399323138 * b.swir1) + 282.49950226294675))
                & (b.tirs1 < ((28.243727598566267 * b.swir1) + 270.5987561075786))
                & (b.tirs1 > ((-1.7241379310344813 * b.swir1) + 270.8445862545011))
            )
            | (
                (b.tirs1 < ((-14.764776839565704 * b.swir1) + 282.2009721876465))
                & (b.tirs1 < ((4484.999999999887 * b.swir1) + 234.03942731053635))
                & (b.tirs1 > ((28.243727598566267 * b.swir1) + 270.5987561075786))
            )
        )


def confusion5c(b):
    """Class spectral overlap (manly snow and ice)"""
    return (
        (
            (b.blue > ((4.8417656150246735 * b.sat) - 2.1345948555473897))
            & (b.blue < ((0.1372549019607847 * b.sat) + 2.541367543066504))
            & (b.blue < ((65.27916047754636 * b.sat) - 44.97113295340387))
        )
        | (
            (b.blue > ((8.084344025406292 * b.sat) - 5.357496374168239))
            & (b.blue < ((4.8417656150246735 * b.sat) - 2.1345948555473897))
            & (b.blue > ((-2.0288015770823886 * b.sat) + 2.7350940836938467))
        )
        | (
            (b.blue < ((-109.79419385952704 * b.sat) + 111.80572088090663))
            & (b.blue < ((8.084344025406292 * b.sat) - 5.357496374168237))
            & (b.blue > ((-4.3978728050230655 * b.sat) + 4.630836908607832))
        )
        | (
            (b.blue < ((-4.3978728050230655 * b.sat) + 4.630836908607832))
            & (b.blue > ((-6.7287331975861875 * b.sat) + 6.496003229047556))
            & (b.blue > ((-1.662267492121429 * b.sat) + 1.8490682560509786))
        )
        | (
            (b.blue > ((-2.290356886887485 * b.sat) + 2.425148455618598))
            & (b.blue < ((-6.7287331975861875 * b.sat) + 6.496003229047557))
            & (b.blue > ((-499.2108270862114 * b.sat) + 400.5826752028271))
        )
        | (
            (b.blue < ((-2.290356886887485 * b.sat) + 2.425148455618598))
            & (b.blue > ((-2.6721311475409864 * b.sat) + 2.7310450819672165))
            & (b.blue > ((-1.557000478788249 * b.sat) + 1.7525179201366887))
        )
        | (
            (b.blue < ((-1.662267492121429 * b.sat) + 1.8490682560509786))
            & (b.blue > ((-4.648304510366765 * b.sat) + 4.58784527684082))
            & (b.blue > ((0.22760258599122304 * b.sat) - 0.07269337962982575))
        )
    )


def confusion6(b):
    """Thermal range"""
    if b.tirs1 is None:
        return b.hue > -100  # always true
    else:
        return (b.tirs1 > 264) & (b.tirs1 < 310)


def clouds(b):
    """Class spectral overlap with specific clouds"""
    return (
        (
            (b.hue < (0.41364045204877986 * b.blue) + 241.58503770843737)
            & (b.hue > (-11159.99999999992 * b.blue) + 706.602272727269)
            & (b.hue > (6.608688285703755 * b.blue) + 192.68448650503294)
        )
        | (
            (b.hue < (6.608688285703755 * b.blue) + 192.68448650503294)
            & (b.hue > (-1185.0000000000016 * b.blue) + 247.52556818181824)
            & (b.hue > (10.590659688301406 * b.blue) + 161.25283307931002)
        )
        | (
            (b.hue < (-2880.000000000025 * b.blue) + 22978.102736040695)
            & (b.hue < (10.590659688301406 * b.blue) + 161.25283307931002)
            & (b.hue > (-8.242805824080952 * b.blue) + 162.61183882935126)
        )
        | (
            (b.hue > (-2.390925916467925 * b.blue) + 116.11991638044418)
            & (b.hue < (-8.242805824080952 * b.blue) + 162.61183882935126)
            & (b.hue > (-474.7757035969288 * b.blue) + 196.2764286118238)
        )
        | (
            (b.hue > (-1.6963273991013927 * b.blue) + 110.6014811233367)
            & (b.hue < (-2.390925916467925 * b.blue) + 116.11991638044418)
            & (b.hue > (-22.581644771334126 * b.blue) + 119.5459742877233)
        )
        | (
            (b.hue < (-22.581644771334126 * b.blue) + 119.5459742877233)
            & (b.hue > (-52.75862068965494 * b.blue) + 124.66654813682212)
            & (b.hue > (5.205078970337692 * b.blue) + 107.64583620801584)
        )
        | (
            (b.hue < (-52.75862068965494 * b.blue) + 124.66654813682212)
            & (b.hue > (-118.032786885246 * b.blue) + 135.7425813797672)
            & (b.hue > (19.636363636364297 * b.blue) + 103.40817124694752)
        )
    )
