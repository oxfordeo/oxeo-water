# @package _global_

# to execute this experiment run:
# python run.py experiment=example_simple.yaml

defaults:
  - override /mode: exp.yaml
  - override /trainer: default.yaml
  - override /model: semseg_model.yaml
  - override /datamodule: tile_datamodule.yaml
  - override /callbacks: wandb.yaml
  - override /logger: wandb.yaml

# all parameters below will be merged with parameters from default configurations set above
# this allows you to overwrite only specified parameters

# name of the run determines folder name in logs
# it's also accessed by loggers
name: "unet_semseg_zimmoz"

seed: 12345
log_level: INFO

trainer:
  min_epochs: 1
  max_epochs: 200
  limit_val_batches: 16
  # limit_train_batches: 20
  precision: 16
  gpus: -1
  resume_from_checkpoint: /home/fran/repos/oxeo-water/oxeo/water/logs/experiments/unet_semseg_all_tiles/runs/2022-01-12/21-21-12/checkpoints/epoch_012.ckpt

model:
  num_classes: 3
  input_channels: 6
  lr: 1e-5


datamodule:
  valid_dates:
    landsat-5:
      34_K_10000_68_774:
      - '2003-11-21'
      34_K_10000_76_817:
      - '2000-01-13'
      34_L_10000_61_830:
      - '1989-06-29'
      35_K_10000_32_768:
      - '1990-09-16'
      35_K_10000_32_769:
      - '2006-11-15'
      35_K_10000_32_770:
      - '2004-07-04'
      35_K_10000_53_763:
      - '1990-07-31'
      35_K_10000_56_758:
      - '1992-05-02'
      35_L_10000_39_827:
      - '2006-06-08'
      35_L_10000_75_826:
      - '1996-09-01'
      36_J_10000_44_712:
      - '1998-11-15'
      36_J_10000_50_719:
      - '1990-09-05'
      36_K_10000_20_805:
      - '1993-10-04'
      36_K_10000_23_803:
      - '1995-08-07'
      36_K_10000_26_770:
      - '1995-09-08'
      36_K_10000_28_770:
      - '2001-02-13'
      36_K_10000_28_771:
      - '1986-11-11'
      36_K_10000_36_783:
      - '1993-03-19'
      36_K_10000_51_748:
      - '1996-06-17'
      36_K_10000_63_815:
      - '1999-01-01'
      36_K_10000_64_814:
      - '2008-03-15'
      36_K_10000_72_753:
      - '1998-12-16'
      36_L_10000_24_827:
      - '1998-07-15'
      36_L_10000_68_866:
      - '1996-05-07'
      36_L_10000_73_839:
      - '1998-12-08'
      36_L_10000_77_830:
      - '1993-06-09'
      36_L_10000_77_831:
      - '2006-06-14'
      36_L_10000_79_829:
      - '2007-05-16'
      36_L_10000_80_838:
      - '2007-08-20'
      37_K_10000_20_793:
      - '1991-01-20'
      37_L_10000_64_882:
      - '2009-04-21'
    landsat-7:
      34_K_10000_66_772:
      - '2015-03-19'
      34_L_10000_75_830:
      - '2015-03-19'
      35_J_10000_72_717:
      - '2004-01-12'
      35_K_10000_32_771:
      - '2005-11-04'
      35_K_10000_40_771:
      - '2003-03-29'
      35_K_10000_58_761:
      - '2002-03-02'
      35_K_10000_63_813:
      - '2009-01-24'
      35_K_10000_77_759:
      - '2018-04-25'
      36_J_10000_24_701:
      - '2015-04-10'
      36_J_10000_44_703:
      - '2009-10-19'
      36_J_10000_62_728:
      - '2007-12-01'
      36_K_10000_24_745:
      - '2019-11-15'
      36_K_10000_25_745:
      - '2007-01-14'
      36_K_10000_41_736:
      - '2004-06-07'
      36_K_10000_59_750:
      - '2015-04-28'
      36_K_10000_60_750:
      - '2008-12-03'
      36_K_10000_68_736:
      - '2018-08-19'
      36_L_10000_23_826:
      - '2020-04-29'
      36_L_10000_31_825:
      - '2002-03-27'
      36_L_10000_39_825:
      - '2005-10-06'
      36_L_10000_40_826:
      - '2002-12-01'
      36_L_10000_40_828:
      - '2006-11-10'
      36_L_10000_42_826:
      - '2006-05-18'
      36_L_10000_53_824:
      - '2015-07-07'
      36_L_10000_77_831:
      - '2002-04-23'
      36_L_10000_80_837:
      - '2012-11-13'
      37_K_10000_20_793:
      - '2012-04-12'
    landsat-8:
      34_L_10000_75_829:
      - '2018-08-25'
      35_K_10000_34_772:
      - '2021-10-06'
      35_K_10000_41_774:
      - '2021-03-28'
      35_K_10000_41_775:
      - '2013-10-25'
      36_J_10000_31_711:
      - '2015-01-21'
      36_J_10000_34_714:
      - '2021-04-27'
      36_J_10000_37_703:
      - '2018-07-17'
      36_J_10000_45_697:
      - '2015-07-09'
      36_J_10000_47_715:
      - '2021-03-03'
      36_J_10000_52_719:
      - '2021-09-11'
      36_J_10000_52_720:
      - '2013-06-17'
      36_J_10000_52_729:
      - '2016-12-02'
      36_J_10000_54_730:
      - '2021-11-14'
      36_J_10000_69_728:
      - '2019-10-16'
      36_K_10000_21_789:
      - '2016-08-17'
      36_K_10000_23_808:
      - '2021-07-30'
      36_K_10000_35_771:
      - '2018-05-12'
      36_K_10000_50_750:
      - '2018-03-02'
      36_K_10000_59_817:
      - '2017-05-18'
      36_K_10000_63_764:
      - '2017-10-02'
      36_K_10000_67_783:
      - '2018-01-22'
      36_K_10000_69_780:
      - '2020-04-17'
      36_K_10000_80_799:
      - '2015-07-09'
      36_L_10000_25_856:
      - '2015-07-05'
      36_L_10000_29_824:
      - '2017-03-29'
      36_L_10000_37_825:
      - '2013-08-18'
      36_L_10000_42_828:
      - '2021-10-27'
      37_K_10000_20_793:
      - '2019-01-17'
      37_L_10000_56_847:
      - '2017-06-22'
    sentinel-2:
      34_K_10000_68_773:
      - '2021-08-28'
      34_K_10000_68_774:
      - '2020-06-24'
      35_J_10000_73_718:
      - '2017-11-27'
      35_K_10000_22_801:
      - '2018-12-02'
      35_K_10000_34_773:
      - '2019-11-04'
      35_K_10000_34_774:
      - '2019-11-04'
      35_K_10000_40_772:
      - '2021-03-23'
      35_K_10000_56_808:
      - '2019-01-30'
      35_L_10000_32_864:
      - '2017-06-10'
      36_J_10000_35_714:
      - '2018-10-05'
      36_J_10000_42_711:
      - '2018-02-22'
      36_J_10000_47_696:
      - '2015-11-22'
      36_J_10000_49_718:
      - '2019-11-06'
      36_K_10000_27_801:
      - '2018-02-15'
      36_K_10000_28_770:
      - '2020-03-17'
      36_L_10000_34_851:
      - '2020-04-25'
      36_L_10000_43_828:
      - '2017-03-22'
      36_L_10000_52_824:
      - '2018-12-29'
      36_L_10000_78_828:
      - '2018-12-06'
      36_L_10000_78_830:
      - '2018-11-11'
      36_L_10000_81_835:
      - '2021-04-30'
      36_L_10000_81_837:
      - '2019-12-27'
      37_L_10000_54_878:
      - '2020-09-23'
      37_L_10000_56_848:
      - '2019-07-21'
      37_L_10000_60_880:
      - '2019-09-09'
  train_constellation_tile_ids:
    landsat-5: ['36_K_10000_64_814',
                '35_K_10000_32_768',
                '36_K_10000_36_783',
                '36_L_10000_73_839',
                '36_K_10000_63_815']
    landsat-7: ['36_K_10000_25_745',
                '35_K_10000_58_761',
                '35_J_10000_72_717',
                '34_L_10000_75_830',
                '36_K_10000_41_736']
    landsat-8: ['36_K_10000_23_808',
                '36_J_10000_31_711',
                '36_K_10000_67_783',
                '36_J_10000_52_729',
                '36_K_10000_59_817']
    "sentinel-2": ['37_L_10000_54_878',
                  '35_K_10000_56_808',
                  '36_J_10000_42_711',
                  '35_K_10000_34_774',
                  '36_L_10000_52_824']
  val_constellation_tile_ids:
    landsat-5: ['35_K_10000_56_758',
                '36_J_10000_44_712',
                '36_K_10000_28_771',
                '36_K_10000_23_803',
                '34_K_10000_76_817',
                '36_K_10000_51_748',
                '36_L_10000_68_866',
                '35_K_10000_32_769',
                '36_L_10000_77_831',
                '35_K_10000_32_770',
                '34_L_10000_61_830',
                '35_K_10000_53_763',
                '35_L_10000_39_827',
                '36_L_10000_79_829',
                '36_J_10000_50_719',
                '36_L_10000_77_830',
                '36_L_10000_80_838',
                '34_K_10000_68_774',
                '36_K_10000_72_753',
                '35_L_10000_75_826',
                '37_K_10000_20_793',
                '36_K_10000_26_770',
                '36_L_10000_24_827',
                '36_K_10000_28_770',
                '37_L_10000_64_882',
                '36_K_10000_20_805']
    landsat-7: ['36_L_10000_53_824',
                '35_K_10000_32_771',
                '36_L_10000_42_826',
                '36_L_10000_23_826',
                '36_L_10000_40_828',
                '36_J_10000_24_701',
                '36_L_10000_77_831',
                '36_K_10000_24_745',
                '36_K_10000_68_736',
                '35_K_10000_63_813',
                '34_K_10000_66_772',
                '36_J_10000_44_703',
                '36_L_10000_31_825',
                '36_J_10000_62_728',
                '36_K_10000_60_750',
                '35_K_10000_77_759',
                '36_L_10000_39_825',
                '36_L_10000_40_826',
                '36_K_10000_59_750',
                '37_K_10000_20_793',
                '36_L_10000_80_837',
                '35_K_10000_40_771']
    landsat-8: ['36_J_10000_34_714',
                '35_K_10000_41_775',
                '36_L_10000_25_856',
                '36_J_10000_47_715',
                '36_K_10000_80_799',
                '36_J_10000_37_703',
                '36_J_10000_69_728',
                '36_K_10000_50_750',
                '35_K_10000_41_774',
                '36_J_10000_54_730',
                '34_L_10000_75_829',
                '37_K_10000_20_793',
                '36_J_10000_52_719',
                '36_L_10000_29_824',
                '36_L_10000_37_825',
                '35_K_10000_34_772',
                '36_L_10000_42_828',
                '36_K_10000_63_764',
                '36_J_10000_52_720',
                '36_J_10000_45_697',
                '36_K_10000_21_789',
                '36_K_10000_35_771',
                '36_K_10000_69_780',
                '37_L_10000_56_847']
    sentinel-2: ['36_L_10000_78_828',
                '36_L_10000_78_830',
                '36_J_10000_47_696',
                '35_K_10000_22_801',
                '37_L_10000_56_848',
                '36_L_10000_43_828',
                '36_L_10000_34_851',
                '35_K_10000_34_773',
                '36_J_10000_49_718',
                '36_J_10000_35_714',
                '36_L_10000_81_837',
                '37_L_10000_60_880',
                '34_K_10000_68_774',
                '36_K_10000_28_770',
                '34_K_10000_68_773',
                '36_K_10000_27_801',
                '35_K_10000_40_772',
                '35_J_10000_73_718',
                '35_L_10000_32_864',
                '36_L_10000_81_835']
  masks: [zimmoz]
  root_dir: "gs://oxeo-water/prod2"
  train_start_date: "0001-01-01"
  train_end_date: "9999-01-01"
  val_start_date: "0001-01-02"
  val_end_date: "9999-01-01"
  bands: [nir, red, green, blue, swir1, swir2]
  target_size: 1000
  chip_size: 256
  revisits_per_epoch: 20
  samples_per_revisit: 250
  batch_size: 64
  num_workers: 6
  pin_memory: False
  cache_dir: "../../cache"
  cache_bytes: 1e11 # a bit less than a 1TB

callbacks:
  log_f1_precision_recall_heatmap: None
  log_confusion_matrix: None
  watch_model: None
  upload_code_as_artifact: None
  early_stopping:
    patience: 50
